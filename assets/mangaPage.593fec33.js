import{Q as Ee}from"./QPage.32043b58.js";import{Q as ke}from"./QImg.4c286d18.js";import{Q as A}from"./QBtn.c248b476.js";import{Q as je,a as V}from"./QMenu.62948ea2.js";import{u as Je}from"./use-quasar.9a62b4af.js";import{g as Xe,s as R}from"./usefull.e82e70c8.js";import{f as G,r as m,_ as x,j as u,y as z,k as b,p as $,v as Q,s as W,t as _,q as p,n as o,F as ce,z as De,x as de,m as l,c as C,a8 as Ye,L as Ke,K as We,o as Ze,h as P,D as y,g as Ge,a0 as ee,Z as xe,a2 as et,W as X,Y as ge,X as te,N as tt,P as B,a7 as Qe,u as Z,aj as at}from"./index.b35b6c87.js";import{Q as U}from"./QIcon.ac005315.js";import{Q as v,a as ae}from"./QItemLabel.f084a15e.js";import{Q as k}from"./QItem.624de6a8.js";import{Q as L}from"./QList.53b7cd17.js";import{Q as lt}from"./QLinearProgress.f297a554.js";import{Q as ot}from"./QIntersection.4210ae17.js";import{u as rt,a as nt}from"./use-dark.1516cb7d.js";import{Q as ye}from"./QResizeObserver.90150d42.js";import{Q as st}from"./QScrollObserver.25b184ae.js";import{T as ue}from"./TouchPan.e5cef90e.js";import{c as it,a as dt,f as ut}from"./QSpinner.cedf2831.js";import{b as Y}from"./format.2a3572e1.js";import{e as $e,s as Se}from"./scroll.fbb25234.js";import{Q as ct}from"./QTooltip.b9c953ce.js";import{Q as mt}from"./QPageSticky.15c3cd3b.js";import{C as w}from"./ClosePopup.57ec600b.js";import{c as le}from"./selection.01e1b310.js";import{R as ft}from"./Ripple.5f8954d8.js";import{p as we}from"./models.4021c4b7.js";import{Q as oe}from"./QTab.6772f4ca.js";import{Q as ht}from"./QTabs.52f3248a.js";import{Q as F}from"./QCardSection.42fc0f1a.js";import{Q as H}from"./QCheckbox.f31e7731.js";import{Q as Ce}from"./QRadio.56d92015.js";import{Q as pt}from"./QCard.70ae0f07.js";import{Q as vt}from"./QDialog.476c5919.js";import{u as bt}from"./useDlSock.1a59372d.js";import"./position-engine.0d3d3347.js";import"./use-timeout.4812ac2b.js";import"./use-transition.6c02567b.js";import"./dom.4a68f118.js";import"./focus-manager.32f8d49a.js";import"./fetcher.f8235356.js";import"./Intersection.7e467ca5.js";import"./uid.42677368.js";import"./rtl.b51694b1.js";import"./use-checkbox.679430af.js";import"./option-sizes.72a65bda.js";import"./use-form.d75ed6a7.js";const kt=G({name:"mangaInfo",props:{manga:{type:Object},offset:{type:Number,default:()=>0}},created:function(){if(this.imgdata&&this.manga)this.getImg();else{const e=this.$watch(()=>[this.imgdata,this.manga],()=>{!this.imgdata&&this.manga&&(this.getImg(),e())})}},methods:{async InLibrary(){this.inLib=!this.inLib,this.inLib?await this.$fetch(`/api/v1/manga/${this.$route.params.mangaID}/library/`):await this.$fetch(`/api/v1/manga/${this.$route.params.mangaID}/library/`,{method:"DELETE"}),this.$emit("inlib")},getImg(){var e;Xe(((e=this.manga)==null?void 0:e.thumbnailUrl)+"?useCache="+this.useCache).then(t=>{this.imgdata=t})}},setup(e){var s;return{useCache:Je().localStorage.getItem("useCache"),inLib:m(((s=e.manga)==null?void 0:s.inLibrary)||!1),imgdata:m()}}}),gt={class:"flex no-wrap"},yt={key:1,class:"q-mx-md",style:{display:"inline-block"}},$t={key:0,class:"text-h5 q-my-xs"},St={class:"text-subtitle1"},wt={key:1,class:"text-h5 q-my-xs"},Ct={class:"text-subtitle1"},zt={key:2,class:"text-h5 q-my-xs"},_t={class:"text-subtitle1"},qt={key:3,class:"text-h5 q-my-xs"},Dt={class:"text-subtitle1"},Qt={class:"q-my-md",style:{display:"flex","justify-content":"space-evenly"}},It={key:1},Mt=Q("h6",{class:"q-my-sm"},"About:",-1),Pt={style:{"font-size":"1.3em"}},Bt={key:2};function Ft(e,t,c,s,S,h){var r,a,n,i,M,I,q;return u(),z("div",{class:"q-px-md q-py-md col MangaInfo",style:de([{"overflow-y":"auto"},e.$q.screen.sm||e.$q.screen.xs?"":"max-height: calc(100vh - "+e.offset+"px)"])},[e.$q.screen.sm||e.$q.screen.xs||e.$q.screen.md?(u(),b(ke,{key:0,style:{width:"fit-content","max-width":"100%"},loading:"lazy",class:"rounded-borders q-mx-md","img-class":"test",src:e.imgdata,fit:"scale-down"},null,8,["src"])):$("",!0),Q("div",gt,[e.$q.screen.sm||e.$q.screen.xs||e.$q.screen.md?$("",!0):(u(),b(ke,{key:0,style:{width:"fit-content","max-width":"50%",flex:"none"},loading:"lazy",class:"rounded-borders","img-class":"test",src:e.imgdata,fit:"scale-down"},null,8,["src"])),e.manga?(u(),z("div",yt,[Q("h3",{style:{"overflow-wrap":"anywhere"},class:W(e.$q.screen.sm||e.$q.screen.xs||e.$q.screen.md?"q-my-sm":"")},_(e.manga.title),3),e.manga.author?(u(),z("div",$t,[p(" Author: "),Q("span",St,_(e.manga.author),1)])):$("",!0),e.manga.artist?(u(),z("div",wt,[p(" Artist: "),Q("span",Ct,_(e.manga.artist),1)])):$("",!0),e.manga.status?(u(),z("div",zt,[p(" Status: "),Q("span",_t,_(e.manga.status),1)])):$("",!0),(r=e.manga.source)!=null&&r.displayName?(u(),z("div",qt,[p(" Source: "),Q("span",Dt,_((a=e.manga.source)==null?void 0:a.displayName),1)])):$("",!0)])):$("",!0)]),Q("div",Qt,[o(A,{flat:"",color:(n=e.manga)!=null&&n.inLibrary?"primary":"grey-9",icon:"favorite",label:(i=e.manga)!=null&&i.inLibrary?"In Library":"Add To Library",onClick:e.InLibrary},null,8,["color","label","onClick"]),o(A,{flat:"",color:"grey-9",icon:"public",label:"Open Site",href:(M=e.manga)==null?void 0:M.realUrl,target:"_blank"},null,8,["href"])]),(I=e.manga)!=null&&I.description?(u(),z("div",It,[Mt,Q("p",Pt,_(e.manga.description),1)])):$("",!0),(q=e.manga)!=null&&q.genre?(u(),z("div",Bt,[(u(!0),z(ce,null,De(e.manga.genre,D=>(u(),b(je,{key:D,outline:"",color:"primary"},{default:l(()=>[p(_(D),1)]),_:2},1024))),128))])):$("",!0)],4)}var At=x(kt,[["render",Ft]]);const ze=["vertical","horizontal"],re={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},_e={prevent:!0,mouse:!0,mouseAllDir:!0},qe=e=>e>=250?50:Math.ceil(e/5);var Tt=it({name:"QScrollArea",props:{...rt,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:t,emit:c}){const s=m(!1),S=m(!1),h=m(!1),r={vertical:m(0),horizontal:m(0)},a={vertical:{ref:m(null),position:m(0),size:m(0)},horizontal:{ref:m(null),position:m(0),size:m(0)}},{proxy:n}=Ge(),i=nt(e,n.$q);let M,I;const q=m(null),D=C(()=>"q-scrollarea"+(i.value===!0?" q-scrollarea--dark":""));a.vertical.percentage=C(()=>{const d=a.vertical.size.value-r.vertical.value;if(d<=0)return 0;const f=Y(a.vertical.position.value/d,0,1);return Math.round(f*1e4)/1e4}),a.vertical.thumbHidden=C(()=>(e.visible===null?h.value:e.visible)!==!0&&s.value===!1&&S.value===!1||a.vertical.size.value<=r.vertical.value+1),a.vertical.thumbStart=C(()=>a.vertical.percentage.value*(r.vertical.value-a.vertical.thumbSize.value)),a.vertical.thumbSize=C(()=>Math.round(Y(r.vertical.value*r.vertical.value/a.vertical.size.value,qe(r.vertical.value),r.vertical.value))),a.vertical.style=C(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${a.vertical.thumbStart.value}px`,height:`${a.vertical.thumbSize.value}px`})),a.vertical.thumbClass=C(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(a.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),a.vertical.barClass=C(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(a.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),a.horizontal.percentage=C(()=>{const d=a.horizontal.size.value-r.horizontal.value;if(d<=0)return 0;const f=Y(a.horizontal.position.value/d,0,1);return Math.round(f*1e4)/1e4}),a.horizontal.thumbHidden=C(()=>(e.visible===null?h.value:e.visible)!==!0&&s.value===!1&&S.value===!1||a.horizontal.size.value<=r.horizontal.value+1),a.horizontal.thumbStart=C(()=>a.horizontal.percentage.value*(r.horizontal.value-a.horizontal.thumbSize.value)),a.horizontal.thumbSize=C(()=>Math.round(Y(r.horizontal.value*r.horizontal.value/a.horizontal.size.value,qe(r.horizontal.value),r.horizontal.value))),a.horizontal.style=C(()=>({...e.thumbStyle,...e.horizontalThumbStyle,left:`${a.horizontal.thumbStart.value}px`,width:`${a.horizontal.thumbSize.value}px`})),a.horizontal.thumbClass=C(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(a.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),a.horizontal.barClass=C(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(a.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const Me=C(()=>a.vertical.thumbHidden.value===!0&&a.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),Pe=[[ue,d=>{pe(d,"vertical")},void 0,{vertical:!0,..._e}]],Be=[[ue,d=>{pe(d,"horizontal")},void 0,{horizontal:!0,..._e}]];function me(){const d={};return ze.forEach(f=>{const g=a[f];d[f+"Position"]=g.position.value,d[f+"Percentage"]=g.percentage.value,d[f+"Size"]=g.size.value,d[f+"ContainerSize"]=r[f].value}),d}const fe=Ye(()=>{const d=me();d.ref=n,c("scroll",d)},0);function he(d,f,g){if(ze.includes(d)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(d==="vertical"?Se:$e)(q.value,f,g)}function Fe({height:d,width:f}){let g=!1;r.vertical.value!==d&&(r.vertical.value=d,g=!0),r.horizontal.value!==f&&(r.horizontal.value=f,g=!0),g===!0&&E()}function Ae({position:d}){let f=!1;a.vertical.position.value!==d.top&&(a.vertical.position.value=d.top,f=!0),a.horizontal.position.value!==d.left&&(a.horizontal.position.value=d.left,f=!0),f===!0&&E()}function Te({height:d,width:f}){a.horizontal.size.value!==f&&(a.horizontal.size.value=f,E()),a.vertical.size.value!==d&&(a.vertical.size.value=d,E())}function pe(d,f){const g=a[f];if(d.isFirst===!0){if(g.thumbHidden.value===!0)return;I=g.position.value,S.value=!0}else if(S.value!==!0)return;d.isFinal===!0&&(S.value=!1);const T=re[f],J=r[f].value,He=(g.size.value-J)/(J-g.thumbSize.value),Ne=d.distance[T.dist],Oe=I+(d.direction===T.dir?1:-1)*Ne*He;be(Oe,f)}function ve(d,f){const g=a[f];if(g.thumbHidden.value!==!0){const T=d[re[f].offset];if(T<g.thumbStart.value||T>g.thumbStart.value+g.thumbSize.value){const J=T-g.thumbSize.value/2;be(J/r[f].value*g.size.value,f)}g.ref.value!==null&&g.ref.value.dispatchEvent(new MouseEvent(d.type,d))}}function Ve(d){ve(d,"vertical")}function Ue(d){ve(d,"horizontal")}function E(){s.value===!0?clearTimeout(M):s.value=!0,M=setTimeout(()=>{s.value=!1},e.delay),e.onScroll!==void 0&&fe()}function be(d,f){q.value[re[f].scroll]=d}function Le(){h.value=!0}function Re(){h.value=!1}let j=null;return Ke(()=>{j={top:a.vertical.position.value,left:a.horizontal.position.value}}),We(()=>{if(j===null)return;const d=q.value;d!==null&&($e(d,j.left),Se(d,j.top))}),Ze(fe.cancel),Object.assign(n,{getScrollTarget:()=>q.value,getScroll:me,getScrollPosition:()=>({top:a.vertical.position.value,left:a.horizontal.position.value}),getScrollPercentage:()=>({top:a.vertical.percentage.value,left:a.horizontal.percentage.value}),setScrollPosition:he,setScrollPercentage(d,f,g){he(d,f*(a[d].size.value-r[d].value),g)}}),()=>P("div",{class:D.value,onMouseenter:Le,onMouseleave:Re},[P("div",{ref:q,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[P("div",{class:"q-scrollarea__content absolute",style:Me.value},dt(t.default,[P(ye,{debounce:0,onResize:Te})])),P(st,{axis:"both",onScroll:Ae})]),P(ye,{debounce:0,onResize:Fe}),P("div",{class:a.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:Ve}),P("div",{class:a.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:Ue}),y(P("div",{ref:a.vertical.ref,class:a.vertical.thumbClass.value,style:a.vertical.style.value,"aria-hidden":"true"}),Pe),y(P("div",{ref:a.horizontal.ref,class:a.horizontal.thumbClass.value,style:a.horizontal.style.value,"aria-hidden":"true"}),Be)])}}),Vt=ut({name:"touch-hold",beforeMount(e,t){const{modifiers:c}=t;if(c.mouse!==!0&&ee.has.touch!==!0)return;const s={handler:t.value,noop:xe,mouseStart(h){typeof s.handler=="function"&&et(h)===!0&&(X(s,"temp",[[document,"mousemove","move","passiveCapture"],[document,"click","end","notPassiveCapture"]]),s.start(h,!0))},touchStart(h){if(h.target!==void 0&&typeof s.handler=="function"){const r=h.target;X(s,"temp",[[r,"touchmove","move","passiveCapture"],[r,"touchcancel","end","notPassiveCapture"],[r,"touchend","end","notPassiveCapture"]]),s.start(h)}},start(h,r){s.origin=ge(h);const a=Date.now();ee.is.mobile===!0&&(document.body.classList.add("non-selectable"),le(),s.styleCleanup=n=>{s.styleCleanup=void 0;const i=()=>{document.body.classList.remove("non-selectable")};n===!0?(le(),setTimeout(i,10)):i()}),s.triggered=!1,s.sensitivity=r===!0?s.mouseSensitivity:s.touchSensitivity,s.timer=setTimeout(()=>{le(),s.triggered=!0,s.handler({evt:h,touch:r!==!0,mouse:r===!0,position:s.origin,duration:Date.now()-a})},s.duration)},move(h){const{top:r,left:a}=ge(h);(Math.abs(a-s.origin.left)>=s.sensitivity||Math.abs(r-s.origin.top)>=s.sensitivity)&&clearTimeout(s.timer)},end(h){te(s,"temp"),s.styleCleanup!==void 0&&s.styleCleanup(s.triggered),s.triggered===!0?h!==void 0&&tt(h):clearTimeout(s.timer)}},S=[600,5,7];if(typeof t.arg=="string"&&t.arg.length>0&&t.arg.split(":").forEach((h,r)=>{const a=parseInt(h,10);a&&(S[r]=a)}),[s.duration,s.touchSensitivity,s.mouseSensitivity]=S,e.__qtouchhold=s,c.mouse===!0){const h=c.mouseCapture===!0||c.mousecapture===!0?"Capture":"";X(s,"main",[[e,"mousedown","mouseStart",`passive${h}`]])}ee.has.touch===!0&&X(s,"main",[[e,"touchstart","touchStart",`passive${c.capture===!0?"Capture":""}`],[e,"touchend","noop","notPassiveCapture"]])},updated(e,t){const c=e.__qtouchhold;c!==void 0&&t.oldValue!==t.value&&(typeof t.value!="function"&&c.end(),c.handler=t.value)},beforeUnmount(e){const t=e.__qtouchhold;t!==void 0&&(te(t,"main"),te(t,"temp"),clearTimeout(t.timer),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchhold)}});const ne=m(null),se=m(null),ie=m(null),N=m(null),K=m(null),O=m("source");function Ie(e){ne.value=B.getItem(`${e}ChUnread`),se.value=B.getItem(`${e}ChDownloaded`),ie.value=B.getItem(`${e}ChBookmarked`),N.value=B.getItem(`${e}ChSource`),K.value=B.getItem(`${e}ChFetchDate`),O.value=B.getItem(`${e}ChDisplay`);const t=function(a){a==null?B.remove(`${e}ChUnread`):B.set(`${e}ChUnread`,a),ne.value=a},c=function(a){R(`${e}ChDownloaded`,a),se.value=a},s=function(a){R(`${e}ChBookmarked`,a),ie.value=a},S=function(a){a!=null&&(R(`${e}ChSource`,a),B.remove(`${e}ChFetchDate`)),N.value=a},h=function(a){a!=null&&(R(`${e}ChFetchDate`,a),B.remove(`${e}ChSource`)),K.value=a},r=function(a){R(`${e}ChDisplay`,a,"source"),O.value=a};return N.value==null&&K.value==null&&(N.value=!1),O.value==null&&(O.value="source"),{Unread:ne,Downloaded:se,Bookmarked:ie,Source:N,FetchDate:K,Display:O,setUnread:t,setDownloaded:c,setBookmarked:s,setSource:S,setFetchDate:h,setDisplay:r}}const Ut=G({name:"libraryTopBar",watch:{unread(){this.filt.setUnread(this.unread)},downloaded(){this.filt.setDownloaded(this.downloaded)},bookmarked(){this.filt.setBookmarked(this.bookmarked)},Source(){this.filt.setSource(this.Source),this.Source!=null&&(this.FetchDate=null)},FetchDate(){this.filt.setFetchDate(this.FetchDate),this.FetchDate!=null&&(this.Source=null)},disp(){this.filt.setDisplay(this.disp)}},methods:{aredefaults(){return this.unread==null&&this.downloaded==null&&this.bookmarked==null&&this.Source==!1&&this.FetchDate==null&&this.disp=="source"}},setup(){const e=Qe(),t=Ie(parseInt(`${e.params.mangaID}`)),c=m(t);return{dialo:m(!1),tab:m("filter"),unread:m(t.Unread),downloaded:m(t.Downloaded),bookmarked:m(t.Bookmarked),Source:m(t.Source),FetchDate:m(t.FetchDate),filt:c,disp:m(t.Display)}}}),Lt={key:0},Rt={key:1},Ht={key:2};function Nt(e,t,c,s,S,h){return u(),z(ce,null,[o(A,{flat:"",class:"q-ml-sm",round:"","text-color":e.$q.dark.isActive?e.aredefaults()?"white":"orange":e.aredefaults()?"dark":"orange",icon:"filter_list",onClick:t[0]||(t[0]=r=>e.dialo=!0)},null,8,["text-color"]),o(vt,{modelValue:e.dialo,"onUpdate:modelValue":t[9]||(t[9]=r=>e.dialo=r)},{default:l(()=>[o(pt,null,{default:l(()=>[o(F,{class:"q-pa-none"},{default:l(()=>[o(ht,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=r=>e.tab=r),class:"text-teal"},{default:l(()=>[o(oe,{class:"q-px-xl",name:"filter",icon:"filter_list",label:"Filter"}),o(oe,{class:"q-px-xl",name:"sort",icon:"sort",label:"Sort"}),o(oe,{class:"q-px-xl",name:"display",icon:"display_settings",label:"Display"})]),_:1},8,["modelValue"])]),_:1}),e.tab=="filter"?(u(),z("div",Lt,[o(F,{class:"q-px-md q-pt-md q-pb-xs"},{default:l(()=>[o(H,{style:{width:"100%"},"toggle-indeterminate":"",modelValue:e.unread,"onUpdate:modelValue":t[2]||(t[2]=r=>e.unread=r),dark:e.$q.dark.isActive,label:"Unread","checked-icon":"check_box","unchecked-icon":"r_disabled_by_default","indeterminate-icon":"check_box_outline_blank","keep-color":"",size:"lg",color:"primary"},null,8,["modelValue","dark"])]),_:1}),o(F,{class:"q-px-md q-py-xs"},{default:l(()=>[o(H,{style:{width:"100%"},"toggle-indeterminate":"",modelValue:e.downloaded,"onUpdate:modelValue":t[3]||(t[3]=r=>e.downloaded=r),label:"Downloaded",dark:e.$q.dark.isActive,"checked-icon":"check_box","unchecked-icon":"r_disabled_by_default","indeterminate-icon":"check_box_outline_blank","keep-color":"",size:"lg",color:"primary"},null,8,["modelValue","dark"])]),_:1}),o(F,{class:"q-px-md q-pt-xs q-pb-md"},{default:l(()=>[o(H,{style:{width:"100%"},"toggle-indeterminate":"",modelValue:e.bookmarked,"onUpdate:modelValue":t[4]||(t[4]=r=>e.bookmarked=r),label:"Bookmarked",dark:e.$q.dark.isActive,"checked-icon":"check_box","unchecked-icon":"r_disabled_by_default","indeterminate-icon":"check_box_outline_blank","keep-color":"",size:"lg",color:"primary"},null,8,["modelValue","dark"])]),_:1})])):$("",!0),e.tab=="sort"?(u(),z("div",Rt,[o(F,{class:"q-px-md q-pt-md q-pb-xs"},{default:l(()=>[o(H,{style:{width:"100%"},"checked-icon":"arrow_upward","unchecked-icon":"arrow_downward","indeterminate-icon":"null",color:"primary","keep-color":"",modelValue:e.Source,"onUpdate:modelValue":t[5]||(t[5]=r=>e.Source=r),label:"By Source",dark:e.$q.dark.isActive},null,8,["modelValue","dark"])]),_:1}),o(F,{class:"q-px-md q-pt-xs q-pb-md"},{default:l(()=>[o(H,{style:{width:"100%"},"checked-icon":"arrow_upward","unchecked-icon":"arrow_downward","indeterminate-icon":"null",color:"primary","keep-color":"",modelValue:e.FetchDate,"onUpdate:modelValue":t[6]||(t[6]=r=>e.FetchDate=r),label:"By Fetch date",dark:e.$q.dark.isActive},null,8,["modelValue","dark"])]),_:1})])):$("",!0),e.tab=="display"?(u(),z("div",Ht,[o(F,{class:"q-px-md q-pt-md q-pb-xs"},{default:l(()=>[o(Ce,{modelValue:e.disp,"onUpdate:modelValue":t[7]||(t[7]=r=>e.disp=r),val:"source",label:"By Source Title"},null,8,["modelValue"])]),_:1}),o(F,{class:"q-px-md q-pt-xs q-pb-md"},{default:l(()=>[o(Ce,{modelValue:e.disp,"onUpdate:modelValue":t[8]||(t[8]=r=>e.disp=r),val:"chapter",label:"By Chapter Number"},null,8,["modelValue"])]),_:1})])):$("",!0)]),_:1})]),_:1},8,["modelValue"])],64)}var Ot=x(Ut,[["render",Nt]]);const Et=G({name:"mangaChapters",created:async function(){this.$bus.on("updateManga",()=>{this.getonline("true")}),this.getonline()},components:{filterr:Ot},computed:{doFilt(){let e=this.chapters;return this.filters.Unread!=null&&(e=e.filter(t=>this.filters.Unread?!t.read:t.read)),this.filters.Downloaded!=null&&(e=e.filter(t=>this.filters.Downloaded?t.downloaded:!t.downloaded)),this.filters.Bookmarked!=null&&(e=e.filter(t=>this.filters.Bookmarked?t.bookmarked:!t.bookmarked)),e},doSrt(){let e=this.doFilt;return this.filters.Source!=null&&(e=e.sort((t,c)=>this.filters.Source?t.index>c.index?1:-1:t.index<c.index?1:-1)),this.filters.FetchDate!=null&&(e=e.sort((t,c)=>this.filters.FetchDate?t.fetchedAt>c.fetchedAt?-1:1:t.fetchedAt<c.fetchedAt?-1:1)),e},itemstyle(){return"background-color:"+(this.$q.dark.isActive?"var(--q-dark)":"var(--q-light)")},res(){const e=this.doSrt.filter(t=>!t.read);if(e.length){const t=e[e.length-1];return`/manga/${t.mangaId}/chapter/${t.index}`}else return`/manga/${this.$route.params.mangaID}/chapter/${1}`}},methods:{moveFab(e){this.draggingFab=e.isFirst!==!0&&e.isFinal!==!0;let t=this.fabPos[0]-e.delta.x,c=this.fabPos[1]-e.delta.y;const s=this.$refs.conta.parentElement.getBoundingClientRect(),S=this.$refs.sticky.$el.getBoundingClientRect(),h=s.height,r=S.height;c>h-r&&(c=h-r),c<0&&(c=0);const a=s.width,n=S.width;t>a-n&&(t=a-n),t<0&&(t=0),this.fabPos=[t,c]},calcHeight(){const e=this.$refs.chapHead;if(e==null)return 0;let t=e.getBoundingClientRect().bottom;return t+=parseInt(window.getComputedStyle(e).getPropertyValue("margin-bottom")),t||0},async getonline(e="false",t=2){try{this.chapters=await this.$fetchJSON(`/api/v1/manga/${this.$route.params.mangaID}/chapters?onlineFetch=${e}`)}catch{t--,t>=0?(console.warn("fetch chapters failed in chapterList Retrying, retries left: "+t),this.getonline(e,t)):console.error("fetch chapters failed in chapterList")}},async download(e){await this.$fetch(`/api/v1/download/${this.$route.params.mangaID}/chapter/${e}`)},async dele(e){await this.$fetch(`/api/v1/manga/${this.$route.params.mangaID}/chapter/${e}`,{method:"DELETE"}),this.getonline()},async mpatch(e,t){const c=new FormData;t.forEach(s=>{c.append(...s)}),await this.$fetch(`/api/v1/manga/${this.$route.params.mangaID}/chapter/${e}`,{method:"PATCH",body:c}),this.getonline()},handleHold(e){this.selectMode=!0,this.selectthis(e)},selectthis(e){this.selected.includes(e)?this.selected=this.selected.filter(t=>t!==e):this.selected.push(e)},selectall(){this.selected.length?this.selected=[]:this.selected=this.doSrt.map(e=>e.id)},dl(e){const t={chapterIds:e};this.$fetch("/api/v1/download/batch",{method:"POST",body:JSON.stringify(t)})},read(e,t=!0,c="isRead"){const s={chapterIds:e,change:{[c]:t}};this.$fetch(`/api/v1/manga/${this.$route.params.mangaID}/chapter/batch`,{method:"POST",body:JSON.stringify(s)}).then(()=>this.getonline())}},watch:{"Emitter.eventsFromServer"(e){const t=JSON.parse(e);if(we(t)){const c=t.queue.filter(s=>s.mangaId==parseInt(`${this.$route.params.mangaID}`));this.downloadsnum!=c.length&&this.getonline(),this.downloadsnum=c.length,this.downloads=c}}},setup(){const e=Qe(),t=m(Ie(parseInt(`${e.params.mangaID}`))),c=m([]),s=m([]),S=bt(),h=m(S),r=m([]),a=m(0),n=S.eventsFromServer.value?JSON.parse(S.eventsFromServer.value):[];if(we(n)){const I=n.queue.filter(q=>q.mangaId==parseInt(`${e.params.mangaID}`));a.value=I.length,r.value=I}h.value.isConnected&&S.sendMsg("STATUS");const i=m([18,18]),M=m(!1);return{chapters:c,chaptersfilt:s,filters:t,Emitter:h,downloadsnum:a,downloads:r,selectMode:m(!1),selected:m([]),fabPos:i,draggingFab:M}}}),jt={ref:"conta"},Jt={class:"row justify-between items-center",ref:"chapHead"},Xt={class:"q-ma-md"},Yt={style:{"padding-right":"12px"}};function Kt(e,t,c,s,S,h){const r=Z("filterr"),a=Z("router-link");return u(),z("div",jt,[Q("div",Jt,[Q("h4",Xt,_(e.chapters.length)+" chapters",1),Q("div",Yt,[e.selectMode?(u(),b(A,{key:0,flat:"",round:"",icon:"select_all",onClick:e.selectall},null,8,["onClick"])):$("",!0),o(A,{flat:"",round:"",icon:e.selectMode?"flip_to_front":"flip_to_back",onClick:t[0]||(t[0]=n=>e.selectMode=!e.selectMode)},null,8,["icon"]),o(A,{round:"",flat:"",icon:"more_vert"},{default:l(()=>[o(V,{anchor:"bottom end",self:"top right"},{default:l(()=>[o(L,{style:{width:"fit-content"}},{default:l(()=>[o(k,{clickable:""},{default:l(()=>[o(v,{side:""},{default:l(()=>[o(U,{name:"keyboard_arrow_left"})]),_:1}),o(v,null,{default:l(()=>[p("download")]),_:1}),o(V,{anchor:"top start",self:"top end",style:{"white-space":"nowrap"}},{default:l(()=>[o(L,null,{default:l(()=>[y((u(),b(k,{clickable:"",onClick:t[1]||(t[1]=n=>e.dl(e.doSrt.filter(i=>!i.downloaded).map(i=>i.id)))},{default:l(()=>[o(v,null,{default:l(()=>[p("Download All")]),_:1})]),_:1})),[[w]]),y((u(),b(k,{clickable:"",onClick:t[2]||(t[2]=n=>e.dl(e.doSrt.filter(i=>!i.downloaded).slice(-5).map(i=>i.id)))},{default:l(()=>[o(v,null,{default:l(()=>[p("Download Next 5")]),_:1})]),_:1})),[[w]]),e.selectMode?y((u(),b(k,{key:0,clickable:"",onClick:t[3]||(t[3]=n=>e.dl(e.selected))},{default:l(()=>[o(v,null,{default:l(()=>[p("Download Selected")]),_:1})]),_:1})),[[w]]):$("",!0)]),_:1})]),_:1})]),_:1}),o(k,{clickable:""},{default:l(()=>[o(v,{side:""},{default:l(()=>[o(U,{name:"keyboard_arrow_left"})]),_:1}),o(v,null,{default:l(()=>[p("Read")]),_:1}),o(V,{anchor:"top start",self:"top end",style:{"white-space":"nowrap"}},{default:l(()=>[o(L,null,{default:l(()=>[y((u(),b(k,{clickable:"",onClick:t[4]||(t[4]=n=>e.read(e.doSrt.filter(i=>!i.read).map(i=>i.id)))},{default:l(()=>[o(v,null,{default:l(()=>[p("Read All")]),_:1})]),_:1})),[[w]]),y((u(),b(k,{clickable:"",onClick:t[5]||(t[5]=n=>e.read(e.doSrt.filter(i=>!i.read).slice(-5).map(i=>i.id)))},{default:l(()=>[o(v,null,{default:l(()=>[p("Read Next 5")]),_:1})]),_:1})),[[w]]),e.selectMode?y((u(),b(k,{key:0,clickable:"",onClick:t[6]||(t[6]=n=>e.read(e.selected))},{default:l(()=>[o(v,null,{default:l(()=>[p("Read Selected")]),_:1})]),_:1})),[[w]]):$("",!0)]),_:1})]),_:1})]),_:1}),o(k,{clickable:""},{default:l(()=>[o(v,{side:""},{default:l(()=>[o(U,{name:"keyboard_arrow_left"})]),_:1}),o(v,null,{default:l(()=>[p("Unread")]),_:1}),o(V,{anchor:"top start",self:"top end",style:{"white-space":"nowrap"}},{default:l(()=>[o(L,null,{default:l(()=>[y((u(),b(k,{clickable:"",onClick:t[7]||(t[7]=n=>e.read(e.doSrt.filter(i=>!!i.read).map(i=>i.id),!1))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unread All")]),_:1})]),_:1})),[[w]]),y((u(),b(k,{clickable:"",onClick:t[8]||(t[8]=n=>e.read(e.doSrt.filter(i=>!!i.read).slice(0,5).map(i=>i.id),!1))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unread Last 5")]),_:1})]),_:1})),[[w]]),e.selectMode?y((u(),b(k,{key:0,clickable:"",onClick:t[9]||(t[9]=n=>e.read(e.selected,!1))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unread Selected")]),_:1})]),_:1})),[[w]]):$("",!0)]),_:1})]),_:1})]),_:1}),o(k,{clickable:""},{default:l(()=>[o(v,{side:""},{default:l(()=>[o(U,{name:"keyboard_arrow_left"})]),_:1}),o(v,null,{default:l(()=>[p("Bookmark")]),_:1}),o(V,{anchor:"top start",self:"top end",style:{"white-space":"nowrap"}},{default:l(()=>[o(L,null,{default:l(()=>[y((u(),b(k,{clickable:"",onClick:t[10]||(t[10]=n=>e.read(e.doSrt.filter(i=>!i.bookmarked).map(i=>i.id),!0,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Bookmark All")]),_:1})]),_:1})),[[w]]),y((u(),b(k,{clickable:"",onClick:t[11]||(t[11]=n=>e.read(e.doSrt.filter(i=>!i.bookmarked).slice(-5).map(i=>i.id),!0,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Bookmark Next 5")]),_:1})]),_:1})),[[w]]),e.selectMode?y((u(),b(k,{key:0,clickable:"",onClick:t[12]||(t[12]=n=>e.read(e.selected,!0,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Bookmark Selected")]),_:1})]),_:1})),[[w]]):$("",!0)]),_:1})]),_:1})]),_:1}),o(k,{clickable:""},{default:l(()=>[o(v,{side:""},{default:l(()=>[o(U,{name:"keyboard_arrow_left"})]),_:1}),o(v,null,{default:l(()=>[p("Unbookmark")]),_:1}),o(V,{anchor:"top start",self:"top end",style:{"white-space":"nowrap"}},{default:l(()=>[o(L,null,{default:l(()=>[y((u(),b(k,{clickable:"",onClick:t[13]||(t[13]=n=>e.read(e.doSrt.filter(i=>!!i.bookmarked).map(i=>i.id),!1,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unbookmark All")]),_:1})]),_:1})),[[w]]),y((u(),b(k,{clickable:"",onClick:t[14]||(t[14]=n=>e.read(e.doSrt.filter(i=>!!i.bookmarked).slice(0,5).map(i=>i.id),!1,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unbookmark Last 5")]),_:1})]),_:1})),[[w]]),e.selectMode?y((u(),b(k,{key:0,clickable:"",onClick:t[15]||(t[15]=n=>e.read(e.selected,!1,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unbookmark Selected")]),_:1})]),_:1})),[[w]]):$("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(r)])],512),o(Tt,{class:W(["q-pr-xs",e.selectMode?" selectmode":""]),dark:e.$q.dark.isActive,style:de(e.$q.screen.sm||e.$q.screen.xs?"height: 50vh":"height: calc(100vh - "+e.calcHeight()+"px)")},{default:l(()=>[(u(!0),z(ce,null,De(e.doSrt,n=>(u(),b(ot,{key:n.index,style:{height:"58px"},class:""},{default:l(()=>[y((u(),b(k,{id:n.id,clickable:"",dark:e.$q.dark.isActive,class:W(["q-ma-sm rounded-borders",(n.read?"text-grey":"")+" "+(e.selected.includes(n.id)&&e.selectMode?"selected":"")]),style:de(e.itemstyle),to:e.selectMode?void 0:"/manga/"+n.mangaId+"/chapter/"+n.index,onClick:i=>e.selectMode?e.selectthis(n.id):void 0,key:n.index},{default:l(()=>[n.bookmarked?(u(),b(v,{key:0,side:""},{default:l(()=>[o(ae,null,{default:l(()=>[o(U,{color:"primary",name:"bookmark",size:"sm"})]),_:1})]),_:1})):$("",!0),o(v,null,{default:l(()=>[o(ae,null,{default:l(()=>[p(_(e.filters.Display=="source"?n.name:"Chapter "+n.chapterNumber),1)]),_:2},1024),o(ae,{caption:""},{default:l(()=>{var i,M,I,q;return[p(_(n.scanlator)+" "+_(new Date(n.uploadDate).toLocaleDateString())+" "+_(n.downloaded?"\u2022 downloaded":"")+" "+_((i=e.downloads.find(D=>D.chapterIndex==n.index))!=null&&i.state?"\u2022 "+((M=e.downloads.find(D=>D.chapterIndex==n.index))==null?void 0:M.state):"")+" ",1),((I=e.downloads.find(D=>D.chapterIndex==n.index))==null?void 0:I.state)=="Downloading"?(u(),b(lt,{key:0,value:(q=e.downloads.find(D=>D.chapterIndex==n.index))==null?void 0:q.progress},null,8,["value"])):$("",!0)]}),_:2},1024)]),_:2},1024),e.selectMode?(u(),b(U,{key:1,class:"flex-right self-center",size:"md",color:e.selected.includes(n.id)?"blue":"",name:e.selected.includes(n.id)?"check_box":"check_box_outline_blank",flat:""},null,8,["color","name"])):$("",!0),o(A,{onClick:t[16]||(t[16]=at(()=>{},["prevent"])),round:"",flat:"",icon:"more_vert",class:"flex-right"},{default:l(()=>[o(V,null,{default:l(()=>[o(L,{style:{width:"fit-content"}},{default:l(()=>[n.downloaded?$("",!0):y((u(),b(k,{key:0,clickable:"",onClick:i=>e.download(n.index)},{default:l(()=>[o(v,null,{default:l(()=>[p("Download")]),_:1})]),_:2},1032,["onClick"])),[[w]]),n.downloaded?y((u(),b(k,{key:1,clickable:"",onClick:i=>e.dele(n.index)},{default:l(()=>[o(v,null,{default:l(()=>[p("Delete")]),_:1})]),_:2},1032,["onClick"])),[[w]]):$("",!0),y((u(),b(k,{clickable:"",onClick:i=>e.mpatch(n.index,[["bookmarked",`${!n.bookmarked}`]])},{default:l(()=>[o(v,null,{default:l(()=>[p(_(n.bookmarked?"Remove bookmark":"Bookmark"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[w]]),y((u(),b(k,{onClick:i=>e.mpatch(n.index,[["read",`${!n.read}`],["lastPageRead","1"]]),clickable:""},{default:l(()=>[o(v,null,{default:l(()=>[p(_(n.read?"Mark as Unread":"Mark as Read"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[w]]),y((u(),b(k,{onClick:i=>e.mpatch(n.index,[["markPrevRead","true"]]),clickable:""},{default:l(()=>[o(v,{style:{"white-space":"nowrap"}},{default:l(()=>[p("Mark previous as Read")]),_:1})]),_:2},1032,["onClick"])),[[w]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["id","dark","class","style","to","onClick"])),[[Vt,()=>e.handleHold(n.id),void 0,{mouse:!0}],[ft]])]),_:2},1024))),128))]),_:1},8,["dark","style","class"]),o(mt,{position:"bottom-right",offset:e.fabPos,ref:"sticky"},{default:l(()=>[o(a,{style:{"text-decoration":"none",color:"inherit"},is:e.draggingFab?"span":"router-link",to:e.res},{default:l(()=>[y((u(),b(A,{fab:"",class:"Fabconsist",label:"Resume",color:"blue",icon:"drag_indicator"},{default:l(()=>[o(ct,null,{default:l(()=>[p(" draggable ")]),_:1})]),_:1})),[[ue,e.moveFab,void 0,{prevent:!0,mouse:!0}]])]),_:1},8,["is","to"])]),_:1},8,["offset"])],512)}var Wt=x(Et,[["render",Kt],["__scopeId","data-v-e2988834"]]);const Zt=G({name:"mangaPage",components:{mangaInfo:At,mangaChapters:Wt},created:async function(){var e;this.$bus.on("updateManga",()=>{this.getonline("true")}),await this.getonline(),this.$emit("setTitle",((e=this.manga)==null?void 0:e.title)||"manga"),new Date(this.manga.lastFetchedAt*1e3)<new Date(new Date().setDate(new Date().getDate()-1))&&this.$bus.emit("updateManga")},methods:{async getonline(e="false",t=3){try{this.manga=await this.$fetchJSON(`/api/v1/manga/${this.$route.params.mangaID}/?onlineFetch=${e}`)}catch{t>=1&&await this.getonline(e,t-1)}},myTweak(e){return this.offset=e,{height:e?`calc(100vh - ${e}px)`:"100vh"}}},setup(){return{manga:m({}),offset:m(Number())}}});function Gt(e,t,c,s,S,h){const r=Z("mangaInfo"),a=Z("mangaChapters");return u(),b(Ee,{class:W(["nowrap",e.$q.screen.sm||e.$q.screen.xs?"col":"row"]),"style-fn":e.myTweak},{default:l(()=>[o(r,{onInlib:e.getonline,manga:e.manga,offset:e.offset,class:"col-6"},null,8,["onInlib","manga","offset"]),o(a,{class:"col-6"})]),_:1},8,["class","style-fn"])}var ja=x(Zt,[["render",Gt]]);export{ja as default};

import{Q as q}from"./QIntersection.4210ae17.js";import{Q as L}from"./QList.53b7cd17.js";import{Q as w}from"./QInnerLoading.950f1dd6.js";import{Q as N}from"./QPage.32043b58.js";import{a as $,u as S}from"./Filters.63365d1c.js";import{Q as B}from"./QImg.4c286d18.js";import{Q as f,a as g}from"./QItemLabel.f084a15e.js";import{Q as h}from"./QBtn.c248b476.js";import{Q as T}from"./QItem.624de6a8.js";import{Q as z}from"./QCard.70ae0f07.js";import{R as F}from"./Ripple.5f8954d8.js";import{u as R}from"./use-quasar.9a62b4af.js";import{g as V}from"./usefull.e82e70c8.js";import{f as _,r as u,_ as k,j as a,k as n,m as s,D as j,v as y,n as r,q as Q,t as p,y as l,p as c,ak as D,u as P,z as U,F as A}from"./index.b35b6c87.js";import"./Intersection.7e467ca5.js";import"./QSpinner.cedf2831.js";import"./use-dark.1516cb7d.js";import"./use-transition.6c02567b.js";import"./QIcon.ac005315.js";import"./dom.4a68f118.js";import"./fetcher.f8235356.js";const E=_({name:"sourceCard",props:{source:{type:Object,required:!0}},emits:["reload"],methods:{capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)},langCodeToName:$,getSetImg(){V(this.source.iconUrl+"?useCache="+this.useCache).then(e=>{this.imgdata=e})}},mounted:function(){this.getSetImg()},watch:{"source.iconUrl"(){this.imgdata="",this.getSetImg()}},setup(){const e=R(),t=u(`${e.localStorage.getItem("useCache")}`),o=u("");return{useCache:t,imgdata:o}}}),O={class:"row content-center col-grow"},J={key:0,style:{color:"red"}},x={class:"flex items-center"};function G(e,t,o,m,d,C){return a(),n(z,{flat:"",class:"q-ma-sm"},{default:s(()=>[j((a(),n(T,{clickable:"",style:{height:"100px"},to:`/sources/${e.source.id}/popular/`},{default:s(()=>[y("div",O,[r(f,{avatar:""},{default:s(()=>[r(B,{src:e.imgdata,loading:"lazy","spinner-color":"white",style:{height:"100px","aspect-ratio":"225/225",width:"fit-content"},class:"rounded-borders items-center justify-center","no-spinner":""},{default:s(()=>[r(w,{showing:!e.imgdata,color:"primary",class:"bg-transparent"},null,8,["showing"])]),_:1},8,["src"])]),_:1}),r(f,{class:"flex-grow"},{default:s(()=>[r(g,null,{default:s(()=>[Q(p(e.capitalizeFirstLetter(e.source.name)),1)]),_:1}),r(g,{caption:""},{default:s(()=>[Q(p(e.langCodeToName(e.source.lang))+" ",1),e.source.isNsfw?(a(),l("span",J,"18+")):c("",!0)]),_:1})]),_:1})]),y("div",x,[e.source.supportsLatest?(a(),n(h,{key:0,class:"q-ma-sm",outline:"",color:"blue",label:"latest",to:`/sources/${e.source.id}/latest/`},null,8,["to"])):c("",!0),e.$q.screen.xs?c("",!0):(a(),n(h,{key:1,class:"q-ma-sm",outline:"",color:"blue",label:"browse",to:`/sources/${e.source.id}/popular/`},null,8,["to"]))])]),_:1},8,["to"])),[[F]])]),_:1})}var H=k(E,[["render",G]]);const K=_({name:"sourcesPage",components:{sourcecard:H},created:function(){this.reload()},methods:{myTweak(e){return{height:e?`calc(100vh - ${e}px)`:"100vh"}},reload(){this.$fetchJSON("/api/v1/source/list").then(e=>{this.list=e,this.filters.setcurrlangs(this.extractLangs(e))})},langCodeToName:$,extractLangs(e){return Array.from(new Set(e.map(t=>t.lang)))}},computed:{uselist(){return this.list.filter(t=>this.langs.includes(t.lang)).sort((t,o)=>t.lang<o.lang?1:t.lang>o.lang?-1:0)}},setup(e,{emit:t}){t("setTitle","Sources");const o=S(),m=u(o.langs);return{list:u([]),langs:m,filters:o,is:D}}}),M={key:0,class:"text-h4 q-ml-xl q-my-lg"};function W(e,t,o,m,d,C){const v=P("sourcecard");return a(),n(N,{"style-fn":e.myTweak},{default:s(()=>[r(L,null,{default:s(()=>[(a(!0),l(A,null,U(e.uselist,(i,I)=>(a(),l("div",{key:I},[e.is.deepEqual(e.uselist.find(b=>b.lang==i.lang),i)?(a(),l("div",M,p(e.langCodeToName(i.lang)),1)):c("",!0),r(q,{style:{height:"100px",width:"100%"},class:"flex-shrink"},{default:s(()=>[r(v,{onReload:e.reload,source:i},null,8,["onReload","source"])]),_:2},1024)]))),128))]),_:1}),r(w,{style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"fit-content",height:"fit-content","background-color":"transparent"},showing:!e.uselist.length,color:"primary"},null,8,["showing"])]),_:1},8,["style-fn"])}var Qe=k(K,[["render",W]]);export{Qe as default};

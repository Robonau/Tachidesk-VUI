import{c as Q,d as k,h as w}from"./QSpinner.cedf2831.js";import{r as b,c as A,w as f,K as O,L as U,o as V,B as _,h as T,S as j,C as F,a8 as K,g as R}from"./index.b35b6c87.js";import{h as B}from"./dom.4a68f118.js";import{d as v,b as S,s as L,c as W}from"./scroll.fbb25234.js";const{passive:s}=j;var Y=Q({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:{default:void 0},initialIndex:Number,disable:Boolean,reverse:Boolean},emits:["load"],setup(l,{slots:x,emit:H}){const n=b(!1),r=b(!0),u=b(null);let c=l.initialIndex||0,e,i;const N=A(()=>"q-infinite-scroll__loading"+(n.value===!0?"":" invisible"));function o(){if(l.disable===!0||n.value===!0||r.value===!1)return;const t=v(e),a=S(e),m=B(e);l.reverse===!1?Math.round(a+m+l.offset)>=Math.round(t)&&d():Math.round(a)<=l.offset&&d()}function d(){if(l.disable===!0||n.value===!0||r.value===!1)return;c++,n.value=!0;const t=v(e);H("load",c,a=>{r.value===!0&&(n.value=!1,F(()=>{if(l.reverse===!0){const m=v(e),C=S(e),D=m-t;L(e,C+D)}a===!0?g():u.value&&u.value.closest("body")&&i()}))})}function y(){c=0}function E(){r.value===!1&&(r.value=!0,e.addEventListener("scroll",i,s)),o()}function g(){r.value===!0&&(r.value=!1,n.value=!1,e.removeEventListener("scroll",i,s),i!==void 0&&i.cancel!==void 0&&i.cancel())}function I(){if(e&&r.value===!0&&e.removeEventListener("scroll",i,s),e=W(u.value,l.scrollTarget),r.value===!0){if(e.addEventListener("scroll",i,s),l.reverse===!0){const t=v(e),a=B(e);L(e,t-a)}o()}}function M(t){c=t}function P(t){t=parseInt(t,10);const a=i;i=t<=0?o:K(o,isNaN(t)===!0?100:t),e&&r.value===!0&&(a!==void 0&&e.removeEventListener("scroll",a,s),e.addEventListener("scroll",i,s))}f(()=>l.disable,t=>{t===!0?g():E()}),f(()=>l.reverse,t=>{n.value===!1&&r.value===!0&&o()}),f(()=>l.scrollTarget,I),f(()=>l.debounce,P);let h=!1;O(()=>{h!==!1&&e&&L(e,h)}),U(()=>{h=e?S(e):!1}),V(()=>{r.value===!0&&e.removeEventListener("scroll",i,s)}),_(()=>{P(l.debounce),I()});const q=R();return Object.assign(q.proxy,{poll:()=>{i!==void 0&&i()},trigger:d,stop:g,reset:y,resume:E,setIndex:M}),()=>{const t=k(x.default,[]);return l.disable!==!0&&r.value===!0&&t[l.reverse===!1?"push":"unshift"](T("div",{class:N.value},w(x.loading))),T("div",{class:"q-infinite-scroll",ref:u},t)}}});export{Y as Q};

import{Q as P,a as D}from"./QItemLabel.f084a15e.js";import{Q as R}from"./QItem.624de6a8.js";import{Q as B}from"./QCardSection.42fc0f1a.js";import{u as F,a as S,Q as V}from"./QBtn.c248b476.js";import{Q as W}from"./QCardActions.ed0a9806.js";import{Q as I}from"./QCard.70ae0f07.js";import{Q as z}from"./QDialog.476c5919.js";import{Q as G}from"./QPage.32043b58.js";import{C as N}from"./ClosePopup.57ec600b.js";import{u as j,a as O,b as A,Q as H}from"./QTabs.52f3248a.js";import{c as E}from"./QSpinner.cedf2831.js";import{c as U,w as x,f as C,r as u,_ as k,a6 as J,a7 as K,j as r,y as h,v as c,n as i,m as s,F as q,z as T,x as m,k as l,s as y,u as v,D as M,q as b,t as p,p as d,a8 as X}from"./index.b35b6c87.js";import{Q as Y}from"./QIntersection.4210ae17.js";import{Q as _}from"./QInnerLoading.950f1dd6.js";import{Q as $}from"./QBadge.811490c6.js";import{Q}from"./QImg.4c286d18.js";import{R as Z}from"./Ripple.5f8954d8.js";import{u as tt}from"./use-quasar.9a62b4af.js";import{g as et}from"./usefull.e82e70c8.js";import{u as at}from"./Filters.ae625f2a.js";import"./use-dark.1516cb7d.js";import"./QIcon.ac005315.js";import"./use-timeout.4812ac2b.js";import"./scroll.fbb25234.js";import"./dom.4a68f118.js";import"./use-transition.6c02567b.js";import"./focus-manager.32f8d49a.js";import"./uid.42677368.js";import"./QResizeObserver.90150d42.js";import"./rtl.b51694b1.js";import"./Intersection.7e467ca5.js";import"./fetcher.f8235356.js";var st=E({name:"QRouteTab",props:{...F,...j},emits:O,setup(t,{slots:e,emit:a}){const n=S({useDisableForRouterLinkProps:!1}),{renderTab:f,$tabs:g}=A(t,e,a,{exact:U(()=>t.exact),...n});return x(()=>`${t.name} | ${t.exact} | ${(n.resolvedLink.value||{}).href}`,()=>{g.verifyRouteModel()}),()=>f(n.linkTag.value,n.linkAttrs.value)}});const rt=C({name:"TabPanel",props:{tabs:{type:Array,default:()=>[]}},setup(){const t=J(),e=K();return e.query.tab===void 0&&t.push({query:{...e.query,tab:0}}),{tab:u(new Number(e.query.tab).valueOf()||0)}}}),it={class:""},ot={class:"q-gutter-y-md"};function nt(t,e,a,n,f,g){return r(),h("div",it,[c("div",ot,[i(H,{modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=o=>t.tab=o),"inline-label":"",style:m("background-color:"+(t.$q.dark.isActive?"var(--q-dark-page)":"white"))},{default:s(()=>[(r(!0),h(q,null,T(t.tabs,o=>(r(),l(st,{key:o.tabID,name:o.tabID,label:o.tabname,class:y(["col-grow",t.$route.query.tab==o.tabID.toString()?"text-primary":""]),flat:"",to:{query:{...t.$route.query,tab:o.tabID}}},null,8,["name","label","to","class"]))),128))]),_:1},8,["modelValue","style"])])])}var lt=k(rt,[["render",nt]]);const dt=C({name:"MangaCard",props:{manga:{type:Object,default:()=>Object},Display:{type:String,default:"compact"}},computed:{listdivClass(){return this.Display=="list"?"text-left q-ml-md text-h5 col-shrink":"text-center text-subtitle1"}},mounted:function(){et(this.manga.thumbnailUrl+"?useCache="+this.useCache).then(t=>{this.imgdata=t})},setup(){const t=tt(),e=u(`${t.localStorage.getItem("useCache")}`),a=u("");return{useCache:e,imgdata:a}}}),ut={class:"transparent absolute-top q-mt-xs q-ml-xs",style:{padding:"0"}},mt=["title"],ct={class:"row items-center col-grow no-wrap"},pt=["title"];function ht(t,e,a,n,f,g){const o=v("router-link");return M((r(),l(I,{flat:"",class:y(["my-card",t.$q.screen.sm||t.$q.screen.xs?"q-ma-xs":"q-ma-sm"]),style:m(t.Display=="list"?"":"background: transparent")},{default:s(()=>[i(o,{to:"/manga/"+t.manga.id,class:y(["cursor-pointer",t.$q.dark.isActive?"text-white":"text-dark"]),style:{"text-decoration":"none"}},{default:s(()=>[t.Display!="list"?(r(),l(Q,{key:0,src:t.imgdata,loading:"lazy","spinner-color":"white",style:{"max-width":"100%","aspect-ratio":"225/350"},class:"rounded-borders","no-spinner":""},{default:s(()=>[i(_,{showing:!t.imgdata,color:"primary"},null,8,["showing"]),c("div",ut,[t.manga.unreadCount?(r(),l($,{key:0,color:"blue",style:m([{width:"min-content",padding:"5px"},t.manga.downloadCount?"border-top-right-radius: 0;border-bottom-right-radius: 0;":""])},{default:s(()=>[b(p(t.manga.unreadCount),1)]),_:1},8,["style"])):d("",!0),t.manga.downloadCount?(r(),l($,{key:1,color:"green",style:m([{width:"min-content",padding:"5px"},t.manga.unreadCount?"border-top-left-radius: 0;border-bottom-left-radius: 0;":""])},{default:s(()=>[b(p(t.manga.downloadCount),1)]),_:1},8,["style"])):d("",!0)]),t.Display=="compact"?(r(),h("div",{key:0,class:"absolute-bottom text-subtitle1 text-center",title:t.manga.title,style:{padding:"0",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical","text-overflow":"ellipsis",height:"3.5rem"}},p(t.manga.title),9,mt)):d("",!0)]),_:1},8,["src"])):d("",!0),c("div",ct,[t.Display=="list"?(r(),l(Q,{key:0,src:t.imgdata,loading:"lazy","spinner-color":"white",style:{height:"93px","aspect-ratio":"225/350",width:"fit-content"},class:"rounded-borders items-center justify-center col-1","no-spinner":""},{default:s(()=>[i(_,{showing:!t.imgdata,color:"primary"},null,8,["showing"])]),_:1},8,["src"])):d("",!0),t.Display!="compact"?(r(),h("div",{key:1,class:y(t.listdivClass),title:t.manga.title,style:m([{padding:"0",display:"-webkit-box","-webkit-line-clamp":"3","-webkit-box-orient":"vertical","text-overflow":"ellipsis",overflow:"hidden",width:"100%"},t.Display=="list"?"":"height: 5.25rem;"])},p(t.manga.title),15,pt)):d("",!0),c("div",{class:y(["justify-end flex items-end col-grow",t.$q.screen.sm||t.$q.screen.xs?"q-mr-xs":"q-mr-lg"])},[t.manga.unreadCount&&t.Display=="list"?(r(),l($,{key:0,color:"blue",style:m([{width:"min-content",padding:"5px"},t.manga.downloadCount?"border-top-right-radius: 0;border-bottom-right-radius: 0;":""])},{default:s(()=>[b(p(t.manga.unreadCount),1)]),_:1},8,["style"])):d("",!0),t.manga.downloadCount&&t.Display=="list"?(r(),l($,{key:1,color:"green",style:m([{width:"min-content",padding:"5px"},t.manga.unreadCount?"border-top-left-radius: 0;border-bottom-left-radius: 0;":""])},{default:s(()=>[b(p(t.manga.downloadCount),1)]),_:1},8,["style"])):d("",!0)],2)])]),_:1},8,["to","class"])]),_:1},8,["class","style"])),[[Z]])}var ft=k(dt,[["render",ht],["__scopeId","data-v-1d0252d3"]]);const gt=C({name:"MangaGrid",components:{MangaCard:ft},computed:{doFilt(){let t=this.mangas;return this.$route.query.q&&(t=t.filter(e=>e.title.toLowerCase().includes(`${this.$route.query.q||""}`.toLowerCase()))),this.filters.unread!=null&&(t=t.filter(e=>this.filters.unread?!!e.unreadCount:!e.unreadCount)),this.filters.downloaded!=null&&(t=t.filter(e=>this.filters.downloaded?!!e.downloadCount:!e.downloadCount)),t},dosrt(){let t=this.doFilt;return this.filters.leftToRead!=null&&(t=t.sort((e,a)=>this.filters.leftToRead?e.unreadCount>=a.unreadCount?-1:1:e.unreadCount<=a.unreadCount?-1:1)),this.filters.alphabetical!=null&&(t=t.sort((e,a)=>this.filters.alphabetical?e.title>=a.title?-1:1:e.title<=a.title?-1:1)),this.filters.ByID!=null&&(t=t.sort((e,a)=>this.filters.ByID?e.id>=a.id?-1:1:e.id<=a.id?-1:1)),t},Displ(){return this.filters.Display==null?"compact":this.filters.Display?"comfort":"list"},widt(){return this.Displ=="list"?"width:100%; height: 109px;":`width: calc(100% / ${this.devider}); aspect-ratio: 225/350;transition: width 0.5s ease-out;`}},methods:{calcWidth(){const t=this.$refs.MangaGrid,e=this.$q.localStorage.getItem("MitemW");t.clientWidth!=null&&(this.devider=Math.round(t.clientWidth/e))},calcHeight(){var e;const t=(e=this.$parent)==null?void 0:e.$el;if(t){let a=t.clientHeight;return a-=t.children[0].clientHeight,a}return 0},async reload(t){t!=null&&(this.mangas=[],this.mangas=await this.$fetchJSON(`/api/v1/category/${this.$route.query.tab}`))}},created:async function(){this.calcWidth=X(this.calcWidth,500),this.reload(this.$route.query.tab)},watch:{"$route.query.tab":async function(t){this.reload(t)}},mounted:function(){this.calcWidth(),this.$nextTick(()=>{window.addEventListener("resize",this.calcWidth)})},beforeUnmount(){window.removeEventListener("resize",this.calcWidth)},setup(){const t=u(at()),e=u(0),a=u(0),n=u([]);return{devider:e,mangas:n,filters:t,clwidth:a}}}),yt={class:"flex",ref:"MangaGrid"};function bt(t,e,a,n,f,g){const o=v("MangaCard");return r(),h(q,null,[c("div",yt,[(r(!0),h(q,null,T(t.dosrt,w=>(r(),l(Y,{key:w.id,style:m(t.widt),transition:"fade"},{default:s(()=>[i(o,{Display:t.Displ,manga:w},null,8,["Display","manga"])]),_:2},1032,["style"]))),128))],512),i(_,{style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"fit-content",height:"fit-content","background-color":"transparent"},showing:!t.dosrt.length,color:"primary"},null,8,["showing"])],64)}var wt=k(gt,[["render",bt]]);const $t=C({name:"libraryPage",components:{TabPanel:lt,MangaGrid:wt},created:async function(){try{const t=await this.$fetchJSON("/api/v1/category");this.tabs=t.map(e=>({tabname:e.name,tabID:e.id}))}catch{this.failedFetch=!0}},methods:{myTweak(t){return{height:t?`calc(100vh - ${t}px)`:"100vh"}}},setup(t,{emit:e}){e("setTitle","Library");const a=u([]),n=u(!1);return{tabs:a,failedFetch:n}}}),vt=c("div",null,"Have you set your server address?",-1),Ct=c("div",null,"Is the server running?",-1),kt=c("div",{class:"q-pt-sm"}," Pressing Ok will take you to the settings page ",-1);function qt(t,e,a,n,f,g){const o=v("TabPanel"),w=v("MangaGrid");return r(),l(G,{"style-fn":t.myTweak},{default:s(()=>[i(o,{active:"",tabs:t.tabs},null,8,["tabs"]),t.failedFetch?d("",!0):(r(),l(w,{key:0})),i(z,{modelValue:t.failedFetch,"onUpdate:modelValue":e[0]||(e[0]=L=>t.failedFetch=L),persistent:""},{default:s(()=>[i(I,{style:{"min-width":"350px"}},{default:s(()=>[i(B,null,{default:s(()=>[i(R,null,{default:s(()=>[i(P,null,{default:s(()=>[i(D,{class:"text-h6 text-negative"},{default:s(()=>[b("Getting categories failed. ")]),_:1}),i(D,{class:"text-info q-pt-lg"},{default:s(()=>[vt,Ct,kt]),_:1})]),_:1})]),_:1})]),_:1}),i(W,{align:"right",class:"text-primary"},{default:s(()=>[M(i(V,{flat:"",label:"ok",to:"/settings"},null,512),[[N]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["style-fn"])}var se=k($t,[["render",qt]]);export{se as default};

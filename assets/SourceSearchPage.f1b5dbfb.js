import{Q as E}from"./QPage.32043b58.js";import{Q as H}from"./QIntersection.4210ae17.js";import{Q as U}from"./QSpinnerDots.8eb40a4c.js";import{Q as M}from"./QInfiniteScroll.a7c6b959.js";import{Q as v}from"./QBtn.c248b476.js";import{Q as A}from"./QPageSticky.15c3cd3b.js";import{Q as _}from"./QCardActions.ed0a9806.js";import{Q as J}from"./QList.53b7cd17.js";import{Q as R}from"./QCard.70ae0f07.js";import{Q as K}from"./QDialog.476c5919.js";import{C as Q}from"./ClosePopup.57ec600b.js";import{m as X}from"./mangaCard.b19f7ce8.js";import{f as S,r as a,_ as b,j as l,y as d,k as f,m as r,n as i,q as D,t as V,p as m,F as p,z as $,u as y,a8 as Y,v as I,D as q,x as Z}from"./index.b35b6c87.js";import{u as x}from"./Filters.ae625f2a.js";import{Q as z}from"./QExpansionItem.e73e9fb1.js";import{a as N,b as T,c as F,d as G,e as L,f as O,g as W,h as B,j as ee}from"./models.4021c4b7.js";import{a as P,Q as g}from"./QItemLabel.f084a15e.js";import{Q as j}from"./QCheckbox.f31e7731.js";import{Q as h}from"./QItem.624de6a8.js";import{Q as te}from"./QSelect.1bc758f5.js";import{Q as ie}from"./QSeparator.8126d6b7.js";import{Q as re}from"./QInput.a9b5ac3c.js";import{Q as le}from"./QIcon.ac005315.js";import{i as se}from"./isConfigurable.00701444.js";import"./QSpinner.cedf2831.js";import"./Intersection.7e467ca5.js";import"./dom.4a68f118.js";import"./scroll.fbb25234.js";import"./Ripple.5f8954d8.js";import"./use-dark.1516cb7d.js";import"./use-timeout.4812ac2b.js";import"./use-transition.6c02567b.js";import"./focus-manager.32f8d49a.js";import"./QInnerLoading.950f1dd6.js";import"./QBadge.811490c6.js";import"./QImg.4c286d18.js";import"./use-quasar.9a62b4af.js";import"./usefull.e82e70c8.js";import"./fetcher.f8235356.js";import"./uid.42677368.js";import"./use-checkbox.679430af.js";import"./option-sizes.72a65bda.js";import"./use-form.d75ed6a7.js";import"./use-key-composition.a9714931.js";import"./QMenu.62948ea2.js";import"./position-engine.0d3d3347.js";import"./selection.01e1b310.js";import"./use-virtual-scroll.ef29f78d.js";import"./rtl.b51694b1.js";import"./format.2a3572e1.js";const ae=S({name:"isGroup",props:{filter:{type:Object,required:!0},position:{type:Number,default:()=>{}}},methods:{doSort(e){N(this.val)&&(e==this.val.index?this.val.ascending=!this.val.ascending:(this.val.index=e,this.val.ascending=!0))}},watch:{val(){typeof this.val=="object"?this.$emit("stateChange",JSON.stringify(this.val),this.position):(typeof this.val=="string"||typeof this.val=="number"||typeof this.val=="boolean")&&this.$emit("stateChange",this.val.toString(),this.position)}},emits:["stateChange"],setup(e){let t;return T(e.filter)?t=a(e.filter.filter.state):F(e.filter)?t=a(e.filter.filter.state):G(e.filter)?t=a(e.filter.filter.state):L(e.filter)?t=a(e.filter.filter.state):O(e.filter)?t=a():W(e.filter)?t=a():B(e.filter)&&(t=a(e.filter.filter.state||"")),{val:t,isfilterCheckBox:T,isfilterSort:F,isfilterSelect:G,isfilterTriState:L,isfilterHeader:O,isfilterSeparator:W,isfilterText:B,isSortState:N}}});function oe(e,t,s,c,C,k){return l(),d(p,null,[e.isfilterCheckBox(e.filter)?(l(),f(h,{key:0},{default:r(()=>[i(g,null,{default:r(()=>[i(P,null,{default:r(()=>[D(V(e.filter.filter.name),1)]),_:1})]),_:1}),i(j,{color:"blue",modelValue:e.val,"onUpdate:modelValue":t[0]||(t[0]=o=>e.val=o)},null,8,["modelValue"])]),_:1})):m("",!0),e.isfilterSelect(e.filter)?(l(),f(h,{key:1},{default:r(()=>[i(te,{modelValue:e.val,"onUpdate:modelValue":t[1]||(t[1]=o=>e.val=o),style:{width:"100%"},options:e.filter.filter.displayValues.map((o,u)=>({label:o,value:u})),"emit-value":"","map-options":"",label:e.filter.filter.name},null,8,["modelValue","options","label"])]),_:1})):m("",!0),e.isfilterTriState(e.filter)?(l(),f(h,{key:2},{default:r(()=>[i(j,{style:{width:"100%"},"toggle-indeterminate":"",modelValue:e.val,"onUpdate:modelValue":t[2]||(t[2]=o=>e.val=o),dark:e.$q.dark.isActive,label:e.filter.filter.name,"checked-icon":"check_box","unchecked-icon":"r_disabled_by_default","indeterminate-icon":"check_box_outline_blank","keep-color":"",size:"lg",color:"blue","indeterminate-value":0,"true-value":1,"false-value":2},null,8,["modelValue","dark","label"])]),_:1})):m("",!0),e.isfilterHeader(e.filter)?(l(),f(h,{key:3},{default:r(()=>[i(g,null,{default:r(()=>[i(P,null,{default:r(()=>[D(V(e.filter.filter.name),1)]),_:1})]),_:1})]),_:1})):m("",!0),e.isfilterSeparator(e.filter)?(l(),f(h,{key:4},{default:r(()=>[i(ie)]),_:1})):m("",!0),e.isfilterText(e.filter)&&typeof e.val=="string"?(l(),f(h,{key:5},{default:r(()=>[i(re,{style:{width:"100%"},outlined:"",label:e.filter.filter.name,modelValue:e.val,"onUpdate:modelValue":t[3]||(t[3]=o=>e.val=o)},null,8,["label","modelValue"])]),_:1})):m("",!0),e.isfilterSort(e.filter)&&e.isSortState(e.val)?(l(),f(z,{key:6,label:e.filter.filter.name,style:{width:"100%"}},{default:r(()=>[(l(!0),d(p,null,$(e.filter.filter.values,(o,u)=>(l(),f(h,{key:u},{default:r(()=>[i(g,{thumbnail:"",class:"q-px-md"},{default:r(()=>[i(le,{name:e.val.index==u?e.val.ascending?"arrow_downward":"arrow_upward":void 0},null,8,["name"])]),_:2},1024),i(g,null,{default:r(()=>[i(v,{flat:"",class:"q-pl-none",style:{width:"100%"},align:"left",label:o,onClick:n=>e.doSort(u)},null,8,["label","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["label"])):m("",!0)],64)}var ne=b(ae,[["render",oe]]);const fe=S({name:"isGroup",props:{filter:{type:Object,required:!0},position:{type:Number,required:!0}},emits:["stateChange"],components:{whatFilter:ne},methods:{stateChange(e,t=void 0){t!=null?(this.status=this.status.filter(s=>s.position!=t),this.status.push({position:t,state:e}),this.$emit("stateChange",this.status,this.position)):this.$emit("stateChange",e,this.position)}},setup(){return{isfilterGroup:ee,status:a([])}}}),ue={key:1};function me(e,t,s,c,C,k){const o=y("whatFilter");return l(),d(p,null,[e.isfilterGroup(e.filter)?(l(),f(z,{key:0,label:e.filter.filter.name},{default:r(()=>[i(J,null,{default:r(()=>[(l(!0),d(p,null,$(e.filter.filter.state,(u,n)=>(l(),d("div",{key:n},[i(o,{onStateChange:e.stateChange,filter:u,position:n},null,8,["onStateChange","filter","position"])]))),128))]),_:1})]),_:1},8,["label"])):m("",!0),e.isfilterGroup(e.filter)?m("",!0):(l(),d("div",ue,[i(o,{onStateChange:e.stateChange,filter:e.filter},null,8,["onStateChange","filter"])]))],64)}var de=b(fe,[["render",me]]);const he=S({name:"mangaSourceGrid",components:{MangaCard:X,isItGroup:de},computed:{Displ(){return this.display.Display==null?"compact":this.display.Display?"comfort":"list"},widt(){return this.Displ=="list"?"width:100%; height: 109px;":`width: calc(100% / ${this.devider}); aspect-ratio: 225/350;transition: width 0.5s ease-out;`}},methods:{calcWidth(){const e=this.$refs.infiniteScrol,t=this.$q.localStorage.getItem("MitemW");e.$el.clientWidth!=null&&(this.devider=Math.round(e.$el.clientWidth/t))},calcHeight(){var t;const e=(t=this.$parent)==null?void 0:t.$el;if(e){let s=e.clientHeight;return s-=e.children[0].clientHeight,s}return 0},async reload(e=1,t){if(this.noinit)if(this.Smitted||this.$route.query.q){const s=this.$fetchJSON(`/api/v1/source/${this.$route.params.sourceID}/search?searchTerm=${this.$route.query.q||""}&pageNum=${e}`,{signal:t});try{return await s}catch{return}}else{const s=this.$fetchJSON(`/api/v1/source/${this.$route.params.sourceID}/${this.$route.params.poplate}/${e}`,{signal:t});try{return await s}catch{return}}else{this.noinit=!0;return}},onLoad(e,t=()=>{}){this.reload(e,this.controller.signal).then(s=>{s!=null&&(this.items.push(...s.mangaList),s.hasNextPage||this.$refs.infiniteScrol.stop()),t()})},resetScroll(){this.items=[],this.controller.abort(),this.controller=new AbortController,this.$refs.infiniteScrol.reset(),this.$refs.infiniteScrol.resume()},getFilts(e=!1){this.$fetchJSON(`/api/v1/source/${this.$route.params.sourceID}/filters${e?"?reset=true":""}`).then(t=>{this.filters=t,this.resetScroll()})},stateChange(e,t){this.stateChanges=this.stateChanges.filter(s=>s.position!=t),typeof e!="string"?e.forEach(s=>{this.stateChanges.push({position:t,state:JSON.stringify(s)})}):this.stateChanges.push({position:t,state:e})},async submitFilters(){await this.$fetch(`/api/v1/source/${this.$route.params.sourceID}/filters`,{method:"POST",body:JSON.stringify(this.stateChanges)}),this.Smitted=!0,this.stateChanges=[],this.resetScroll(),this.getFilts()}},created:async function(){this.calcWidth=Y(this.calcWidth,500)},mounted:function(){this.calcWidth(),this.$nextTick(()=>{window.addEventListener("resize",this.calcWidth)}),this.getFilts(!0)},beforeUnmount(){window.removeEventListener("resize",this.calcWidth)},watch:{"$route.query.q":function(){this.resetScroll()}},setup(){const e=a(new AbortController);return{devider:a(0),mangas:a([]),clwidth:a(0),display:a(x()),filters:a([]),items:a([]),filterDial:a(!1),stateChanges:a([]),Smitted:a(!1),noinit:a(!1),controller:e}}}),pe={class:"flex"},ce={class:"row justify-center q-my-md"};function ge(e,t,s,c,C,k){const o=y("MangaCard"),u=y("isItGroup");return l(),d(p,null,[i(M,{onLoad:e.onLoad,offset:e.$q.screen.height/2,ref:"infiniteScrol"},{loading:r(()=>[I("div",ce,[i(U,{color:"primary",size:"40px"})])]),default:r(()=>[I("div",pe,[(l(!0),d(p,null,$(e.items,n=>(l(),f(H,{key:n.id,style:Z(e.widt)},{default:r(()=>[i(o,{Display:e.Displ,manga:n},null,8,["Display","manga"])]),_:2},1032,["style"]))),128))])]),_:1},8,["onLoad","offset"]),i(A,{position:"bottom-right",offset:[18,18]},{default:r(()=>[i(v,{fab:"",class:"text-black",icon:"filter_list",color:"blue",label:"FILTER",onClick:t[0]||(t[0]=n=>e.filterDial=!0)})]),_:1}),i(K,{modelValue:e.filterDial,"onUpdate:modelValue":t[2]||(t[2]=n=>e.filterDial=n)},{default:r(()=>[i(R,{style:{width:"500px"}},{default:r(()=>[i(_,{align:"between"},{default:r(()=>[q(i(v,{flat:"",label:"Reset",color:"blue",onClick:t[1]||(t[1]=n=>e.getFilts(!0))},null,512),[[Q]]),q(i(v,{color:"blue",class:"text-black",label:"Submit",onClick:e.submitFilters},null,8,["onClick"]),[[Q]])]),_:1}),i(J,null,{default:r(()=>[(l(!0),d(p,null,$(e.filters,(n,w)=>(l(),f(u,{onStateChange:e.stateChange,filter:n,position:w,key:w},null,8,["onStateChange","filter","position"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var ve=b(he,[["render",ge]]);const $e=S({name:"ScourceSearchPage",components:{sourceGrid:ve},created:async function(){try{const e=await this.$fetchJSON(`/api/v1/source/${this.$route.params.sourceID}`);this.$emit("setTitle",e.displayName),this.isConfi.setConfigurable(e.isConfigurable)}catch(e){console.error(e)}},methods:{myTweak(e){return{height:e?`calc(100vh - ${e}px)`:"100vh"}}},setup(e,{emit:t}){return t("setTitle","Source Search Page"),{isConfi:se()}}});function ye(e,t,s,c,C,k){const o=y("sourceGrid");return l(),f(E,{"style-fn":e.myTweak},{default:r(()=>[i(o)]),_:1},8,["style-fn"])}var gt=b($e,[["render",ye]]);export{gt as default};

import{Q as ce}from"./QSpinnerDots.8eb40a4c.js";import{Q as he}from"./QPage.32043b58.js";import{m as fe}from"./mangaCard.b19f7ce8.js";import{_ as de,f as me,a8 as pe,r as W,j as S,k as ve,m as _e,u as ye,v as L,y as $,z as U,F as H,n as K,p as X,t as we,x as ge}from"./index.b35b6c87.js";import{u as Pe}from"./Filters.ae625f2a.js";import"./QSpinner.cedf2831.js";import"./QInnerLoading.950f1dd6.js";import"./use-dark.1516cb7d.js";import"./use-transition.6c02567b.js";import"./QBadge.811490c6.js";import"./QImg.4c286d18.js";import"./QCard.70ae0f07.js";import"./Ripple.5f8954d8.js";import"./dom.4a68f118.js";import"./use-quasar.9a62b4af.js";import"./usefull.e82e70c8.js";import"./fetcher.f8235356.js";var ae={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function c(o,s,a){this.fn=o,this.context=s,this.once=a||!1}function _(o,s,a,l,w){if(typeof a!="function")throw new TypeError("The listener must be a function");var y=new c(a,l||o,w),d=t?t+s:s;return o._events[d]?o._events[d].fn?o._events[d]=[o._events[d],y]:o._events[d].push(y):(o._events[d]=y,o._eventsCount++),o}function v(o,s){--o._eventsCount===0?o._events=new n:delete o._events[s]}function h(){this._events=new n,this._eventsCount=0}h.prototype.eventNames=function(){var s=[],a,l;if(this._eventsCount===0)return s;for(l in a=this._events)e.call(a,l)&&s.push(t?l.slice(1):l);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(a)):s},h.prototype.listeners=function(s){var a=t?t+s:s,l=this._events[a];if(!l)return[];if(l.fn)return[l.fn];for(var w=0,y=l.length,d=new Array(y);w<y;w++)d[w]=l[w].fn;return d},h.prototype.listenerCount=function(s){var a=t?t+s:s,l=this._events[a];return l?l.fn?1:l.length:0},h.prototype.emit=function(s,a,l,w,y,d){var E=t?t+s:s;if(!this._events[E])return!1;var u=this._events[E],Q=arguments.length,C,p;if(u.fn){switch(u.once&&this.removeListener(s,u.fn,void 0,!0),Q){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,a),!0;case 3:return u.fn.call(u.context,a,l),!0;case 4:return u.fn.call(u.context,a,l,w),!0;case 5:return u.fn.call(u.context,a,l,w,y),!0;case 6:return u.fn.call(u.context,a,l,w,y,d),!0}for(p=1,C=new Array(Q-1);p<Q;p++)C[p-1]=arguments[p];u.fn.apply(u.context,C)}else{var le=u.length,N;for(p=0;p<le;p++)switch(u[p].once&&this.removeListener(s,u[p].fn,void 0,!0),Q){case 1:u[p].fn.call(u[p].context);break;case 2:u[p].fn.call(u[p].context,a);break;case 3:u[p].fn.call(u[p].context,a,l);break;case 4:u[p].fn.call(u[p].context,a,l,w);break;default:if(!C)for(N=1,C=new Array(Q-1);N<Q;N++)C[N-1]=arguments[N];u[p].fn.apply(u[p].context,C)}}return!0},h.prototype.on=function(s,a,l){return _(this,s,a,l,!1)},h.prototype.once=function(s,a,l){return _(this,s,a,l,!0)},h.prototype.removeListener=function(s,a,l,w){var y=t?t+s:s;if(!this._events[y])return this;if(!a)return v(this,y),this;var d=this._events[y];if(d.fn)d.fn===a&&(!w||d.once)&&(!l||d.context===l)&&v(this,y);else{for(var E=0,u=[],Q=d.length;E<Q;E++)(d[E].fn!==a||w&&!d[E].once||l&&d[E].context!==l)&&u.push(d[E]);u.length?this._events[y]=u.length===1?u[0]:u:v(this,y)}return this},h.prototype.removeAllListeners=function(s){var a;return s?(a=t?t+s:s,this._events[a]&&v(this,a)):(this._events=new n,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=t,h.EventEmitter=h,r.exports=h})(ae);var be=ae.exports;class oe extends Error{constructor(e){super(e),this.name="TimeoutError"}}class Ee extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const Z=r=>globalThis.DOMException===void 0?new Ee(r):new DOMException(r),ee=r=>{const e=r.reason===void 0?Z("This operation was aborted."):r.reason;return e instanceof Error?e:Z(e)};function Te(r,e,t,n){let c;const _=new Promise((v,h)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){v(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){const{signal:o}=n;o.aborted&&h(ee(o)),o.addEventListener("abort",()=>{h(ee(o))})}c=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{v(t())}catch(a){h(a)}return}const o=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,s=t instanceof Error?t:new oe(o);typeof r.cancel=="function"&&r.cancel(),h(s)},e),(async()=>{try{v(await r)}catch(o){h(o)}finally{n.customTimers.clearTimeout.call(void 0,c)}})()});return _.clear=()=>{clearTimeout(c),c=void 0},_}function Qe(r,e,t){let n=0,c=r.length;for(;c>0;){const _=Math.trunc(c/2);let v=n+_;t(r[v],e)<=0?(n=++v,c-=_+1):c=_}return n}var q=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},T;class Ie{constructor(){T.set(this,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,run:e};if(this.size&&q(this,T,"f")[this.size-1].priority>=t.priority){q(this,T,"f").push(n);return}const c=Qe(q(this,T,"f"),n,(_,v)=>v.priority-_.priority);q(this,T,"f").splice(c,0,n)}dequeue(){const e=q(this,T,"f").shift();return e==null?void 0:e.run}filter(e){return q(this,T,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return q(this,T,"f").length}}T=new WeakMap;var f=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,c){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!c:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?c.call(r,t):c?c.value=t:e.set(r,t),t},i=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},m,M,O,x,G,k,D,b,A,g,F,P,z,I,R,te,re,ue,ie,ne,se,B,j,J,Y,V;const xe=new oe;class Ce extends Error{}class Se extends be{constructor(e){var t,n,c,_;if(super(),m.add(this),M.set(this,void 0),O.set(this,void 0),x.set(this,0),G.set(this,void 0),k.set(this,void 0),D.set(this,0),b.set(this,void 0),A.set(this,void 0),g.set(this,void 0),F.set(this,void 0),P.set(this,0),z.set(this,void 0),I.set(this,void 0),R.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Ie,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(_=(c=e.interval)===null||c===void 0?void 0:c.toString())!==null&&_!==void 0?_:""}\` (${typeof e.interval})`);f(this,M,e.carryoverConcurrencyCount,"f"),f(this,O,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),f(this,G,e.intervalCap,"f"),f(this,k,e.interval,"f"),f(this,g,new e.queueClass,"f"),f(this,F,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,f(this,R,e.throwOnTimeout===!0,"f"),f(this,I,e.autoStart===!1,"f")}get concurrency(){return i(this,z,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);f(this,z,e,"f"),i(this,m,"m",Y).call(this)}async add(e,t={}){return new Promise((n,c)=>{const _=async()=>{var v,h,o;f(this,P,(h=i(this,P,"f"),h++,h),"f"),f(this,x,(o=i(this,x,"f"),o++,o),"f");try{if(!((v=t.signal)===null||v===void 0)&&v.aborted){c(new Ce("The task was aborted."));return}const a=await(this.timeout===void 0&&t.timeout===void 0?e({signal:t.signal}):Te(Promise.resolve(e({signal:t.signal})),t.timeout===void 0?this.timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?i(this,R,"f"):t.throwOnTimeout)&&c(xe)}));n(a),this.emit("completed",a)}catch(s){c(s),this.emit("error",s)}i(this,m,"m",ue).call(this)};i(this,g,"f").enqueue(_,t),i(this,m,"m",B).call(this),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return i(this,I,"f")?(f(this,I,!1,"f"),i(this,m,"m",Y).call(this),this):this}pause(){f(this,I,!0,"f")}clear(){f(this,g,new(i(this,F,"f")),"f")}async onEmpty(){i(this,g,"f").size!==0&&await i(this,m,"m",V).call(this,"empty")}async onSizeLessThan(e){i(this,g,"f").size<e||await i(this,m,"m",V).call(this,"next",()=>i(this,g,"f").size<e)}async onIdle(){i(this,P,"f")===0&&i(this,g,"f").size===0||await i(this,m,"m",V).call(this,"idle")}get size(){return i(this,g,"f").size}sizeBy(e){return i(this,g,"f").filter(e).length}get pending(){return i(this,P,"f")}get isPaused(){return i(this,I,"f")}}M=new WeakMap,O=new WeakMap,x=new WeakMap,G=new WeakMap,k=new WeakMap,D=new WeakMap,b=new WeakMap,A=new WeakMap,g=new WeakMap,F=new WeakMap,P=new WeakMap,z=new WeakMap,I=new WeakMap,R=new WeakMap,m=new WeakSet,te=function(){return i(this,O,"f")||i(this,x,"f")<i(this,G,"f")},re=function(){return i(this,P,"f")<i(this,z,"f")},ue=function(){var e;f(this,P,(e=i(this,P,"f"),e--,e),"f"),i(this,m,"m",B).call(this),this.emit("next")},ie=function(){this.emit("empty"),i(this,P,"f")===0&&this.emit("idle")},ne=function(){i(this,m,"m",J).call(this),i(this,m,"m",j).call(this),f(this,A,void 0,"f")},se=function(){const e=Date.now();if(i(this,b,"f")===void 0){const t=i(this,D,"f")-e;if(t<0)f(this,x,i(this,M,"f")?i(this,P,"f"):0,"f");else return i(this,A,"f")===void 0&&f(this,A,setTimeout(()=>{i(this,m,"m",ne).call(this)},t),"f"),!0}return!1},B=function(){if(i(this,g,"f").size===0)return i(this,b,"f")&&clearInterval(i(this,b,"f")),f(this,b,void 0,"f"),i(this,m,"m",ie).call(this),!1;if(!i(this,I,"f")){const e=!i(this,m,"a",se);if(i(this,m,"a",te)&&i(this,m,"a",re)){const t=i(this,g,"f").dequeue();return t?(this.emit("active"),t(),e&&i(this,m,"m",j).call(this),!0):!1}}return!1},j=function(){i(this,O,"f")||i(this,b,"f")!==void 0||(f(this,b,setInterval(()=>{i(this,m,"m",J).call(this)},i(this,k,"f")),"f"),f(this,D,Date.now()+i(this,k,"f"),"f"))},J=function(){i(this,x,"f")===0&&i(this,P,"f")===0&&i(this,b,"f")&&(clearInterval(i(this,b,"f")),f(this,b,void 0,"f")),f(this,x,i(this,M,"f")?i(this,P,"f"):0,"f"),i(this,m,"m",Y).call(this)},Y=function(){for(;i(this,m,"m",B).call(this););},V=async function(e,t){return new Promise(n=>{const c=()=>{t&&!t()||(this.off(e,c),n())};this.on(e,c)})};const qe=me({components:{mangaCard:fe},methods:{myTweak(r){return{height:r?`calc(100vh - ${r}px)`:"100vh"}},calcWidth(){const r=this.$refs.infiniteScrol,e=this.$q.localStorage.getItem("MitemW");r.clientWidth!=null&&(this.devider=Math.round(r.clientWidth/e))},doSearch(){this.$route.query.q&&(this.queue.clear(),this.queue.pending&&(this.controller.abort(),this.controller=new AbortController),this.searchResults=[],this.sources.forEach(r=>{this.queue.add(async({signal:e})=>{if(e){const t=this.$fetchJSON(`/api/v1/source/${r.id}/search?searchTerm=${this.$route.query.q||""}&pageNum=1`,{signal:e});try{return{source:r,mangas:(await t).mangaList}}catch(n){if(console.log(n),!(n instanceof DOMException))return{source:r,mangas:[]}}}return{source:r,mangas:[]}},{signal:this.controller.signal})}))}},watch:{"$route.query.q"(){this.doSearch()}},created:function(){this.calcWidth=pe(this.calcWidth,500),this.$fetchJSON("/api/v1/source/list").then(r=>{this.sources=r,this.doSearch()}),this.queue.on("completed",r=>{r!=null&&(this.searchResults=this.searchResults.concat(r).sort((e,t)=>e.mangas.length==0?1:t.mangas.length==0?-1:0))})},mounted:function(){this.calcWidth(),this.$nextTick(()=>{window.addEventListener("resize",this.calcWidth)})},beforeUnmount(){window.removeEventListener("resize",this.calcWidth)},computed:{Displ(){return this.display.Display==null?"compact":this.display.Display?"comfort":"compact"},widt(){return`width: calc(100% / ${this.devider}); aspect-ratio: 225/350;transition: width 0.5s ease-out;height: fit-content;`}},setup(){const r=new Se({concurrency:5}),e=W(new AbortController),t=W([]),n=W([]);return{searchResults:t,queue:r,controller:e,sources:n,display:W(Pe()),devider:W(0)}}}),$e={ref:"infiniteScrol"},Ne={class:"text-h6 q-ma-md"},We={style:{"white-space":"nowrap","overflow-x":"auto"}},Ae={key:0,class:"text-subtitle1 q-ma-md"},Me={key:0,class:"row justify-center q-my-md"};function Oe(r,e,t,n,c,_){const v=ye("mangaCard");return S(),ve(he,{"style-fn":r.myTweak},{default:_e(()=>[L("div",$e,[(S(!0),$(H,null,U(r.searchResults,({source:h,mangas:o},s)=>(S(),$("div",{key:s},[L("div",null,[L("div",Ne,we(h.displayName),1),L("div",We,[(S(!0),$(H,null,U(o,a=>(S(),$("div",{key:a.id,style:ge([r.widt,{display:"inline-block"}])},[K(v,{manga:a,Display:r.Displ},null,8,["manga","Display"])],4))),128)),o.length?X("",!0):(S(),$("div",Ae," No Manga "))])])]))),128))],512),r.queue.pending?(S(),$("div",Me,[K(ce,{color:"primary",size:"40px"})])):X("",!0)]),_:1},8,["style-fn"])}var et=de(qe,[["render",Oe]]);export{et as default};

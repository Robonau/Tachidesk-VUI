import{Q as P}from"./QIcon.ac005315.js";import{Q as g,a as i}from"./QItemLabel.f084a15e.js";import{Q as j}from"./QLinearProgress.f297a554.js";import{Q as k}from"./QBtn.c248b476.js";import{Q as $}from"./QItem.624de6a8.js";import{Q as O}from"./QList.53b7cd17.js";import{u as H,a as J}from"./use-dark.1516cb7d.js";import{c as M,h as W,a as G}from"./QSpinner.cedf2831.js";import{c as v,h as p,g as K,r as h,w as D,ao as X,B as Y,K as Z,L as ee,o as te,S as B,_ as ae,f as le,j as m,k as q,m as a,y as E,p as y,D as Q,n as t,q as I,t as _,v as s,aj as oe}from"./index.b35b6c87.js";import{u as re,a as se}from"./use-virtual-scroll.ef29f78d.js";import{c as ie}from"./scroll.fbb25234.js";import{Q as ne}from"./QCardSection.42fc0f1a.js";import{Q as de}from"./QCardActions.ed0a9806.js";import{Q as ue}from"./QCard.70ae0f07.js";import{Q as ce}from"./QDialog.476c5919.js";import{Q as fe}from"./QPage.32043b58.js";import{R as me}from"./Ripple.5f8954d8.js";import{C as F}from"./ClosePopup.57ec600b.js";import{u as ve}from"./useDlSock.1a59372d.js";import{p as L}from"./models.4021c4b7.js";import{u as he}from"./use-quasar.9a62b4af.js";import"./rtl.b51694b1.js";import"./dom.4a68f118.js";import"./use-timeout.4812ac2b.js";import"./use-transition.6c02567b.js";import"./focus-manager.32f8d49a.js";const pe=["horizontal","vertical","cell","none"];var ge=M({name:"QMarkupTable",props:{...H,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:e=>pe.includes(e)}},setup(e,{slots:l}){const d=K(),r=J(e,d.proxy.$q),n=v(()=>`q-markup-table q-table__container q-table__card q-table--${e.separator}-separator`+(r.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(e.dense===!0?" q-table--dense":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")+(e.square===!0?" q-table--square":"")+(e.wrapCells===!1?" q-table--no-wrap":""));return()=>p("div",{class:n.value},[p("table",{class:"q-table"},W(l.default))])}});function _e(e,l){return p("div",e,[p("table",{class:"q-table"},l)])}const be={list:O,table:ge},we=["list","table","__qtable"];var Se=M({name:"QVirtualScroll",props:{...re,type:{type:String,default:"list",validator:e=>we.includes(e)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}},setup(e,{slots:l,attrs:d}){let r;const n=h(null),u=v(()=>e.itemsSize>=0&&e.itemsFn!==void 0?parseInt(e.itemsSize,10):Array.isArray(e.items)?e.items.length:0),{virtualScrollSliceRange:o,localResetVirtualScroll:c,padVirtualScroll:b,onVirtualScrollEvt:x}=se({virtualScrollLength:u,getVirtualScrollTarget:A,getVirtualScrollEl:T}),N=v(()=>{if(u.value===0)return[];const f=(R,U)=>({index:o.value.from+U,item:R});return e.itemsFn===void 0?e.items.slice(o.value.from,o.value.to).map(f):e.itemsFn(o.value.from,o.value.to-o.value.from).map(f)}),C=v(()=>"q-virtual-scroll q-virtual-scroll"+(e.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(e.scrollTarget!==void 0?"":" scroll")),z=v(()=>e.scrollTarget!==void 0?{}:{tabindex:0});D(u,()=>{c()}),D(()=>e.scrollTarget,()=>{S(),w()});function T(){return n.value.$el||n.value}function A(){return r}function w(){r=ie(T(),e.scrollTarget),r.addEventListener("scroll",x,B.passive)}function S(){r!==void 0&&(r.removeEventListener("scroll",x,B.passive),r=void 0)}function V(){let f=b(e.type==="list"?"div":"tbody",N.value.map(l.default));return l.before!==void 0&&(f=l.before().concat(f)),G(l.after,f)}return X(()=>{c()}),Y(()=>{w()}),Z(()=>{w()}),ee(()=>{S()}),te(()=>{S()}),()=>{if(l.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return e.type==="__qtable"?_e({ref:n,class:"q-table__middle "+C.value},V()):p(be[e.type],{...d,ref:n,class:[d.class,C.value],...z.value},V)}}});const ke=le({created(){this.$bus.on("DLFilter",e=>{this.filtering=e})},methods:{myTweak(e){return{height:e?`calc(100vh - ${e}px)`:"100vh"}},async delet(e){this.$fetch(`/api/v1/download/${e.mangaId}/chapter/${e.chapterIndex}`,{method:"DELETE"}),this.$fetch(`/api/v1/manga/${e.mangaId}/chapter/${e.chapterIndex}`,{method:"DELETE"})},dontshowagain(){this.$q.localStorage.set("dontshowagainWH",!0)}},watch:{"Emitter.eventsFromServer"(e){const l=JSON.parse(e);L(l)&&(this.downloads=l.queue)}},computed:{downlfilt(){return this.filtering.length?this.downloads.filter(e=>this.filtering.includes(e.state)):this.downloads}},setup(e,{emit:l}){l("setTitle","Downloads");const d=he(),r=ve(),n=h(r),u=d.localStorage.getItem("baseUrl"),o=h([]),c=r.eventsFromServer.value?JSON.parse(r.eventsFromServer.value):[];L(c)&&(o.value=c.queue),n.value.isConnected&&r.sendMsg("STATUS");const b=h(new URL(u).origin!=location.origin&&!d.localStorage.getItem("dontshowagainWH")&&!!d.localStorage.getItem("auth"));return{downloads:o,goodBase:b,Emitter:n,filtering:h([])}}}),qe={key:0},ye={key:1},Qe={class:"col-6"},xe=s("div",null," 1. Move this UI to the same origin as the server (Recomended) ",-1),Ce=s("div",null,"replace the default webui files with this ones files",-1),Te=s("div",null,"or some reverse proxy jank",-1),Ve=s("div",null,"2. dissable authentication on the webhook url",-1),$e=s("div",null,"/api/v1/downloads",-1),De=s("div",null,"with some reverse proxy jank",-1),Be=s("div",null,"3. dissable authentication",-1),Ee=s("div",null,"in server configs",-1),Ie=s("div",null,"4. Go to the default webUI and login",-1),Fe=s("div",null,"per browser",-1),Le=s("div",null," this is a temporary fix as it will clear after a month (i think) ",-1);function Me(e,l,d,r,n,u){return m(),q(fe,{class:"flex items-center justify-center","style-fn":e.myTweak},{default:a(()=>[!e.downloads.length&&e.Emitter.isConnected?(m(),E("div",qe,"No Downloads")):y("",!0),!e.downlfilt.length&&e.downloads.length&&e.Emitter.isConnected?(m(),E("div",ye," No Downloads fit filter ")):y("",!0),e.downlfilt.length?(m(),q(Se,{key:2,items:e.downlfilt,class:"self-start",style:{flex:"auto",height:"100%"},dark:e.$q.dark.isActive},{default:a(({item:o})=>[Q((m(),q($,{clickable:"",class:"q-pa-lg"},{default:a(()=>[t(g,{avatar:""},{default:a(()=>[t(P,{name:"drag_handle",size:"sm"})]),_:1}),t(g,null,{default:a(()=>[t(i,{class:"text-weight-medium text-h6"},{default:a(()=>[I(_(o.manga.title),1)]),_:2},1024),t(i,{caption:"",class:""},{default:a(()=>[s("div",Qe," Chapter "+_(o.chapterIndex)+" ("+_((o.progress*100).toFixed(2))+"%) => state: "+_(o.state),1),t(j,{value:o.progress,style:{width:"100%","max-width":"500px"}},null,8,["value"])]),_:2},1024)]),_:2},1024),t(g,{avatar:""},{default:a(()=>[t(k,{onClick:[l[0]||(l[0]=oe(()=>{},["prevent"])),c=>e.delet(o)],round:"",flat:"",icon:"delete",class:"flex-right"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)),[[me]])]),_:1},8,["items","dark"])):y("",!0),t(ce,{modelValue:e.goodBase,"onUpdate:modelValue":l[1]||(l[1]=o=>e.goodBase=o),persistent:""},{default:a(()=>[t(ue,{style:{"min-width":"350px"}},{default:a(()=>[t(ne,{class:""},{default:a(()=>[t($,null,{default:a(()=>[t(g,null,{default:a(()=>[t(i,{class:"text-h6 text-negative"},{default:a(()=>[I(" Downloads webhook may not work with authentication. ")]),_:1}),t(i,{class:"text-info q-pt-lg"},{default:a(()=>[xe]),_:1}),t(i,{caption:"",class:"text-info"},{default:a(()=>[Ce,Te]),_:1}),t(i,{class:"text-info q-pt-lg"},{default:a(()=>[Ve]),_:1}),t(i,{caption:"",class:"text-info"},{default:a(()=>[$e,De]),_:1}),t(i,{class:"text-info q-pt-lg"},{default:a(()=>[Be]),_:1}),t(i,{caption:"",class:"text-info"},{default:a(()=>[Ee]),_:1}),t(i,{class:"text-info q-pt-lg"},{default:a(()=>[Ie]),_:1}),t(i,{caption:"",class:"text-info"},{default:a(()=>[Fe,Le]),_:1})]),_:1})]),_:1})]),_:1}),t(de,{align:"right",class:"text-primary"},{default:a(()=>[Q(t(k,{flat:"",label:"Ok"},null,512),[[F]]),Q(t(k,{flat:"",label:"Dont show again",onClick:e.dontshowagain},null,8,["onClick"]),[[F]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["style-fn"])}var ut=ae(ke,[["render",Me]]);export{ut as default};
